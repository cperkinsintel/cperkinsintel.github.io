<!DOCTYPE html>
<html>
  <head>
    <title>Collage of Tears</title>
    <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
    <script src="https://cdn.socket.io/socket.io-1.0.0.js"></script>
    <script src="http://127.0.0.1:3001/comm1.js"></script>
    <script src="http://127.0.0.1:3001/comm2.js"></script>
  </head>
  <body>
    <div class="fc">
      <div>
        <header><h1>Welcome to the Collage of Tears</h1></header>
        Ajax: <button onclick="say_hi()">HI!</button>
        <div>
          WebSocket:
          <button onclick="make_connection()">Make Connection</button>
          <button onclick="say_hello()">HELLO!</button>
        </div>
        <div>
          Window
          <button onclick="open_win()">Open Win</button>
          <button onclick="say_howdy()">HOWDY!</button>
        </div>
        
      </div>
      <div>
        <img src="http://127.0.0.1:3001/chris-tango_sm.jpg" alt="oy" width="200">
        <img src="http://127.0.0.1:3001/fish.jpg" alt="fish">
      </div>
    </div>
    <script>
      function say_hi(){
        $.ajax({
          url: "http://127.0.0.1:3001/hi",
          dataType:"json"
          })
        .then(function(d){
          console.log("HI response: ", d);
        })
        .fail(function(er){
          console.log("FAIL: ", er);
        });
      }
      /* ---------------
         WEB SOCKET
         --------------- */
      var socket;
      
      function make_connection(){
        socket = io("http://127.0.0.1:3001");
        socket.on("news", function(data){
          console.log("YAY!! news received", data);
        });
      }
      
      
      function say_hello(){
        socket.emit("hello", {greeting:"hello"} /*, function(d){
          console.log("HELLO -- ACK!!", d);
        }*/);
      }
      /* ---------------
         WINDOW OPEN
         --------------- */
      var otherwin;
      function open_win(){
        otherwin = window.open("http://127.0.0.1:3001/flasher.html");
      }
      function say_howdy(){
        otherwin.postMessage("hello there!", "*");
      }
      
      
      function receiveMessage(event){
        console.log("message received", event.origin);
        
      }
      window.addEventListener("message", receiveMessage, false);
    </script>
  </body>
</html>
